#include <SoftwareSerial.h>

SoftwareSerial mySerial(A3, A2); // RX, TX

const int RELAY_PIN = 9;  // the Arduino pin, which connects to the IN pin of relay


float LIMITE_FLUXO = 2;
float  fluxoviagem = 0;

void setup() {
  Serial.begin(115200);
  pinMode(RELAY_PIN, OUTPUT);
  delay(1000);

  digitalWrite(RELAY_PIN, LOW);
  delay(1000);
  digitalWrite(RELAY_PIN, HIGH);

  Serial.println("primeiro print");
//  attachInterrupt(digitalPinToInterrupt(sensorPin), pulseCounter, FALLING);
  // Configuração da taxa de dados para a porta SoftwareSerial
  mySerial.begin(115200);

}
void loop() {
//  while (mySerial.available()) {
//    Serial.write(mySerial.read());
//  }

if (mySerial.available()) {
    int receivedNumber = mySerial.read();
    Serial.print("status feed: /n ");
    Serial.println(receivedNumber);
    // desligado
    if (receivedNumber == 48 ) {
      if (digitalRead(RELAY_PIN) == LOW) {
        digitalWrite(RELAY_PIN, HIGH);
        Serial.print("desliguei ");
      }
    }
    //ligado 
    if (receivedNumber == 49  ) {
      if (digitalRead(RELAY_PIN) == HIGH) {
        digitalWrite(RELAY_PIN, LOW);
        Serial.print("liguei ");
      }
    }
    
//-------MODO VIAGEM------

    if (receivedNumber == 51) {
      if (digitalRead(RELAY_PIN) == HIGH) {

        digitalWrite(RELAY_PIN, LOW);
        Serial.print("desliguei 51 ");
      }
    }
   if (receivedNumber == 50){
        if (digitalRead(RELAY_PIN) == LOW && fluxoviagem > LIMITE_FLUXO) {
           Serial.print(fluxoviagem);
           delay(1000);
           digitalWrite(RELAY_PIN, HIGH);
           Serial.println("Relé acionado devido à presença de fluxo no modo viagem");
        }
      }
    }
  }
